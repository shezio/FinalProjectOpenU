# ××¡××š ×˜×›× ×™ ×¡×•×¤×™: ×ª××™×›×” ×‘×¨×™×‘×•×™ ×—×•× ×›×™× ×œ×™×œ×“

---

## ğŸ“‹ ×ª×§×¦×™×¨ ×”×©×™× ×•×™

×”××¢×¨×›×ª ×ª×ª××•×š ×‘××¦×‘ ×‘×• **×œ×™×œ×“ ×™×›×•×œ×™× ×œ×”×™×•×ª ××¡×¤×¨ ×—×•× ×›×™×**, ××š **×œ×›×œ ×—×•× ×š ×™×© ×—× ×™×š ××—×“ ×‘×œ×‘×“**.

---

## ğŸ”„ ×©× ×™ ×–×¨×™××•×ª ×œ×™×¦×™×¨×ª ×—×•× ×›×•×ª

### ×–×¨×™××” 1: ××©×£ ×”×”×ª×××•×ª (Wizard)
- ××¦×™×’ ×”×ª×××•×ª ××¤×©×¨×™×•×ª
- **×©×™× ×•×™:** ×œ×”×¦×™×’ ×’× ×™×œ×“×™× ×©×›×‘×¨ ×™×© ×œ×”× ×—×•× ×š (××¤×©×¨ ×œ×”×•×¡×™×£ ×¢×•×“)
- **×©×™× ×•×™:** ×œ× ×œ×”×¦×™×’ ×—×•× ×›×™× ×©×›×‘×¨ ×™×© ×œ×”× ×—× ×™×š

### ×–×¨×™××” 2: ×“×•×— ×”×ª×××•×ª ××¤×©×¨×™×•×ª (Manual Match)
- ××¦×™×’ ×¨×©×™××ª ×™×œ×“×™× ×•×—×•× ×›×™× ××¤×©×¨×™×™×
- **×©×™× ×•×™:** ×œ×”×¦×™×’ ×™×œ×“×™× ×’× ×× ×™×© ×œ×”× ×—×•× ×š ××—×“
- **×©×™× ×•×™:** ×œ× ×œ×”×¦×™×’ ×—×•× ×›×™× ×©×›×‘×¨ ×™×© ×œ×”× ×—× ×™×š

---

## ğŸ—„ï¸ ×©×™× ×•×™×™× ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×

### ××¦×‘ × ×•×›×—×™ (×œ× ×˜×•×‘):

```
Tutorships
â”œâ”€â”€ id (PK)
â”œâ”€â”€ child_id (FK â†’ Children) 
â”œâ”€â”€ tutor_id (FK â†’ Tutors)    â† ×‘×¢×™×”: ×¨×§ ×—×•× ×š ××—×“
â”œâ”€â”€ status
â”œâ”€â”€ created_date
â””â”€â”€ ...
```

### ××¦×‘ ×—×“×© (×¢× ×˜×‘×œ×ª ×§×©×¨):

```
Tutorships
â”œâ”€â”€ id (PK)
â”œâ”€â”€ child_id (FK â†’ Children)
â”œâ”€â”€ status
â”œâ”€â”€ created_date
â””â”€â”€ ...

TutorshipTutors (×˜×‘×œ×ª ×§×©×¨ ×—×“×©×”!)
â”œâ”€â”€ id (PK)
â”œâ”€â”€ tutorship_id (FK â†’ Tutorships)
â”œâ”€â”€ tutor_id (FK â†’ Tutors)
â”œâ”€â”€ joined_date
â”œâ”€â”€ left_date (nullable - ×œ××§×¨×” ×©×—×•× ×š ×¢×–×‘)
â””â”€â”€ is_active (boolean)
```

**×™×ª×¨×•× ×•×ª:**
- ×™×œ×“ ×™×›×•×œ ×œ×”×™×•×ª ××—×•×‘×¨ ×œ××¡×¤×¨ ×—×•× ×›×™×
- ×”×™×¡×˜×•×¨×™×” ×©×œ ×—×•× ×›×™× (××™ ×”×¦×˜×¨×£ ×•××ª×™, ××™ ×¢×–×‘ ×•××ª×™)
- ××¤×©×¨ ×œ×¡××Ÿ ×—×•× ×š ×›×œ×-×¤×¢×™×œ ×‘×œ×™ ×œ××—×•×§

### ××œ×˜×¨× ×˜×™×‘×” ×¤×©×•×˜×” ×™×•×ª×¨:

×× ×œ× ×¦×¨×™×š ×”×™×¡×˜×•×¨×™×”, ××¤×©×¨ ×¤×©×•×˜:
```
Tutorships (×›××• ×”×™×•× - ×¨×©×•××” ×œ×›×œ ×¦××“ ×™×œ×“-×—×•× ×š)
â”œâ”€â”€ id (PK)
â”œâ”€â”€ child_id (FK â†’ Children)
â”œâ”€â”€ tutor_id (FK â†’ Tutors)
â”œâ”€â”€ status
â”œâ”€â”€ created_date
â””â”€â”€ ...

UNIQUE constraint: (child_id, tutor_id) - ×œ×× ×•×¢ ×›×¤×™×œ×•×™×•×ª
```

**×–×” ×‘×¢×¦× ×”××¦×‘ ×”×™×•×**, ×¨×§ ×¦×¨×™×š:
1. ×œ×”×¡×™×¨ ××ª ×”×”× ×—×” ×‘×§×•×“ ×©×œ×›×œ ×™×œ×“ ×™×© ×¨×§ ×—×•× ×›×•×ª ××—×ª
2. ×œ×•×•×“× ×©×”-UNIQUE constraint ×”×•× ×¢×œ (child_id, tutor_id) ×•×œ× ×¢×œ child_id ×‘×œ×‘×“

---

## ğŸ”‘ ×”×¡×‘×¨ ×¢×œ PrevTutorshipStatuses

### ×œ××” ×–×” ×§×™×™×?

×›×©×™×•×¦×¨×™× ×—×•× ×›×•×ª, ×”×¡×˜×˜×•×¡×™× ××©×ª× ×™×:
- ×™×œ×“: `××—×¤×©_×—×•× ×š` â†’ `×™×©_×—×•× ×š`
- ×—×•× ×š: `××™×Ÿ_×—× ×™×š` â†’ `×™×©_×—× ×™×š`

×›×©××•×—×§×™× ×—×•× ×›×•×ª, ×¦×¨×™×š ×œ×“×¢×ª ××” ×”×™×” ×”×¡×˜×˜×•×¡ **×œ×¤× ×™** ×”×™×¦×™×¨×” ×›×“×™ ×œ×©×—×–×¨ ××•×ª×•.

### ×”×˜×‘×œ×”:
```
PrevTutorshipStatuses
â”œâ”€â”€ tutorship_id (FK â†’ Tutorships)
â”œâ”€â”€ prev_tutoring_status  â†’ ×”×¡×˜×˜×•×¡ ×”×§×•×“× ×©×œ ×”×™×œ×“
â””â”€â”€ prev_tutorship_status â†’ ×”×¡×˜×˜×•×¡ ×”×§×•×“× ×©×œ ×”×—×•× ×š
```

### ×‘×¢×™×” ×¢× ×¨×™×‘×•×™ ×—×•× ×›×™×:

×× ×œ×™×œ×“ ×™×© 2 ×—×•× ×›×™× ×•××•×—×§×™× ××—×“:
```
×™×œ×“ #5 â† ×—×•× ×š #10 (×—×•× ×›×•×ª #100)
×™×œ×“ #5 â† ×—×•× ×š #20 (×—×•× ×›×•×ª #200)
```

×× ××•×—×§×™× ×—×•× ×›×•×ª #100:
- âŒ ×”×§×•×“ ×”×™×©×Ÿ: ××—×–×™×¨ ×¡×˜×˜×•×¡ ×™×œ×“ ×œ-`××—×¤×©_×—×•× ×š` (×©×’×•×™!)
- âœ… ×”×§×•×“ ×”×—×“×©: ×‘×•×“×§ ×× ×™×© ×¢×•×“ ×—×•× ×›×•×™×•×ª â†’ ×× ×›×Ÿ, ××©××™×¨ `×™×©_×—×•× ×š`

---

## ğŸ“ ×¨×©×™××ª ×©×™× ×•×™×™× ××¤×•×¨×˜×ª

### 1. models.py - ××™×Ÿ ×©×™× ×•×™ ×‘××‘× ×”!

×”××‘× ×” ×”× ×•×›×—×™ ×›×‘×¨ ×ª×•××š ×‘×¨×™×‘×•×™ (ForeignKey ×•×œ× OneToOne).
×¨×§ ×¦×¨×™×š ×œ×•×•×“× ×©××™×Ÿ UNIQUE constraint ×¢×œ child_id ×‘×œ×‘×“.

```python
class Tutorships(models.Model):
    child = models.ForeignKey(Children, ...)  # âœ… ×›×‘×¨ ForeignKey
    tutor = models.ForeignKey(Tutors, ...)    # âœ… ×›×‘×¨ ForeignKey
    
    class Meta:
        # ×œ×•×•×“× ×©×–×” ×›×š:
        unique_together = [['child', 'tutor']]  # ×œ× unique ×¢×œ child ×‘×œ×‘×“!
```

### 2. utils.py - `fetch_possible_matches()`

**×©×™× ×•×™ ×‘××œ×’×•×¨×™×ª× ×”×”×ª×××”:**

```python
# ×œ×¤× ×™ (×©×’×•×™):
WHERE ch.child_id NOT IN (
    SELECT DISTINCT t.child_id 
    FROM childsmile_app_tutorships t
    WHERE t.status != '×œ×_×¤×¢×™×œ'
)

# ××—×¨×™ (× ×›×•×Ÿ):
# ×œ×”×¡×™×¨ ××ª ×”×ª× ××™ ×”×–×” ×œ×’××¨×™ - ×™×œ×“×™× ×¢× ×—×•× ×š ×™×•×¤×™×¢×• ×’×
# ××‘×œ ×œ×”×•×¡×™×£ ×ª× ××™ ×©×—×•× ×›×™× ×¢× ×—× ×™×š ×œ× ×™×•×¤×™×¢×•:
WHERE tu.id_id NOT IN (
    SELECT DISTINCT t.tutor_id 
    FROM childsmile_app_tutorships t
    WHERE t.status != '×œ×_×¤×¢×™×œ'
)
```

### 3. tutorship_views.py - `create_tutorship()`

**×©×™× ×•×™ ×‘×œ×•×’×™×§×ª ×™×¦×™×¨×”:**

```python
def create_tutorship(request):
    # ... ×§×•×“ ×§×™×™× ...
    
    # ×©××™×¨×ª ×¡×˜×˜×•×¡×™× ×§×•×“××™× - ×¨×§ ×× ×–×• ×”×—×•× ×›×•×ª ×”×¨××©×•× ×” ×œ×™×œ×“
    existing_tutorships = Tutorships.objects.filter(
        child=child, 
        status='×¤×¢×™×œ'
    ).exists()
    
    if not existing_tutorships:
        # ×–×• ×”×—×•× ×›×•×ª ×”×¨××©×•× ×” - ×œ×©××•×¨ ×¡×˜×˜×•×¡ ×§×•×“× ×©×œ ×™×œ×“
        PrevTutorshipStatuses.objects.create(
            tutorship=tutorship,
            prev_tutoring_status=child.tutoring_status,
            prev_tutorship_status=tutor.tutorship_status
        )
        child.tutoring_status = "×™×©_×—×•× ×š"
        child.save()
    else:
        # ×›×‘×¨ ×™×© ×—×•× ×›×•×™×•×ª - ×œ×©××•×¨ ×¨×§ ×¡×˜×˜×•×¡ ×§×•×“× ×©×œ ×—×•× ×š
        PrevTutorshipStatuses.objects.create(
            tutorship=tutorship,
            prev_tutoring_status=child.tutoring_status,  # ×™×™×©××¨ ×™×©_×—×•× ×š
            prev_tutorship_status=tutor.tutorship_status
        )
        # ×œ× ××©× ×™× ×¡×˜×˜×•×¡ ×™×œ×“ - ×›×‘×¨ ×™×©_×—×•× ×š
    
    # ×ª××™×“ ×œ×¢×“×›×Ÿ ×¡×˜×˜×•×¡ ×—×•× ×š
    tutor.tutorship_status = "×™×©_×—× ×™×š"
    tutor.save()
```

### 4. tutorship_views.py - `delete_tutorship()`

**×©×™× ×•×™ ×‘×œ×•×’×™×§×ª ××—×™×§×”:**

```python
def delete_tutorship(request, tutorship_id):
    tutorship = Tutorships.objects.get(id=tutorship_id)
    child = tutorship.child
    tutor = tutorship.tutor
    
    prev_status = PrevTutorshipStatuses.objects.filter(tutorship=tutorship).first()
    
    # 1. ×©×—×–×•×¨ ×¡×˜×˜×•×¡ ×”×—×•× ×š - ×ª××™×“
    if prev_status:
        tutor.tutorship_status = prev_status.prev_tutorship_status
    else:
        tutor.tutorship_status = "××™×Ÿ_×—× ×™×š"
    tutor.save()
    
    # 2. ×‘×“×™×§×” ×× ×œ×™×œ×“ ×™×© ×¢×•×“ ×—×•× ×›×•×™×•×ª ×¤×¢×™×œ×•×ª
    other_tutorships = Tutorships.objects.filter(
        child=child, 
        status='×¤×¢×™×œ'
    ).exclude(id=tutorship.id).exists()
    
    # 3. ×©×—×–×•×¨ ×¡×˜×˜×•×¡ ×”×™×œ×“ - ×¨×§ ×× ××™×Ÿ ×¢×•×“ ×—×•× ×›×•×™×•×ª
    if not other_tutorships:
        if prev_status:
            child.tutoring_status = prev_status.prev_tutoring_status
        else:
            child.tutoring_status = "××—×¤×©_×—×•× ×š"
        child.save()
    # ×× ×™×© ×¢×•×“ ×—×•× ×›×•×™×•×ª - ×œ× ××©× ×™× (× ×©××¨ ×™×©_×—×•× ×š)
    
    # 4. ××—×™×§×ª ×¨×©×•××•×ª ×§×©×•×¨×•×ª
    if prev_status:
        prev_status.delete()
    tutorship.delete()
```

### 5. family_views.py - `get_complete_family_details()`

**×©×™× ×•×™ ×œ×”×—×–×¨×ª ×¨×©×™××ª ×—×•× ×›×™×:**

```python
# ×œ×¤× ×™ (×—×•× ×š ××—×“):
tutorship = Tutorships.objects.filter(child_id=child_id).first()
tutor_info = {...}

# ××—×¨×™ (×¨×©×™××ª ×—×•× ×›×™×):
tutorships = Tutorships.objects.filter(
    child_id=child_id,
    status='×¤×¢×™×œ'
).select_related('tutor__id')

tutors_info = []
for tutorship in tutorships:
    if tutorship.tutor:
        tutors_info.append({
            'tutor_id': tutorship.tutor.id_id,
            'tutor_name': f"{tutorship.tutor.id.first_name} {tutorship.tutor.id.surname}",
            'tutor_phone': tutorship.tutor.id.phone,
            'tutor_email': tutorship.tutor.id.email,
            'tutorship_id': tutorship.id,
            'tutorship_created': tutorship.created_date,
            'relationship_status': tutorship.tutor.relationship_status,
            'tutee_wellness': tutorship.tutor.tutee_wellness,
        })

# ×œ×”×—×–×™×¨ tutors_info ×‘××§×•× tutor_info
```

### 6. family_views.py - `update_family()`

**×©×™× ×•×™ ×œ×ª××™×›×” ×‘×¢×“×›×•×Ÿ ×—×•× ×š ×¡×¤×¦×™×¤×™:**

```python
# ×œ×¤× ×™:
tutorship = Tutorships.objects.filter(child_id=family_id).first()

# ××—×¨×™ - ×œ×§×‘×œ tutor_id ××”×‘×§×©×”:
tutor_id = data.get('tutor_id')
if tutor_id:
    tutorship = Tutorships.objects.filter(
        child_id=family_id,
        tutor_id=tutor_id,
        status='×¤×¢×™×œ'
    ).first()
else:
    # fallback - ×”×—×•× ×š ×”×¨××©×•×Ÿ (×œ×ª××™××•×ª ××—×•×¨×”)
    tutorship = Tutorships.objects.filter(
        child_id=family_id,
        status='×¤×¢×™×œ'
    ).first()
```

### 7. Frontend - Families.js

**×©×™× ×•×™ ×œ×”×¦×’×ª ×¨×©×™××ª ×—×•× ×›×™×:**

```javascript
// ×œ×¤× ×™:
{family.tutor_name && (
  <p>×—×•× ×š: {family.tutor_name}</p>
)}

// ××—×¨×™:
{family.tutors && family.tutors.length > 0 && (
  <div>
    <h4>×—×•× ×›×™× ({family.tutors.length}):</h4>
    {family.tutors.map(tutor => (
      <div key={tutor.tutor_id}>
        <p>{tutor.tutor_name} - {tutor.tutor_phone}</p>
      </div>
    ))}
  </div>
)}
```

### 8. Frontend - Tutorships.js

**×©×™× ×•×™ ×‘××©×£ ×”×”×ª×××•×ª:**

×”×§×•×“ ×›×‘×¨ ××˜×¤×œ ×‘×”×ª×××•×ª ×œ×¤×™ child_id + tutor_id, ××– ×œ× ×¦×¨×™×š ×©×™× ×•×™ ×’×“×•×œ.
×¨×§ ×œ×•×•×“× ×©×œ× ××¡× ×Ÿ ×™×œ×“×™× ×¢× ×—×•× ×š ×§×™×™×.

### 9. report_views.py - `possible_tutorship_matches_report()`

**×©×™× ×•×™ ×‘×“×•×— ×”×ª×××•×ª ××¤×©×¨×™×•×ª:**

```python
# ×œ×”×¦×™×’ ×™×œ×“×™× ×’× ×× ×™×© ×œ×”× ×—×•× ×š
# ×œ× ×œ×”×¦×™×’ ×—×•× ×›×™× ×©×™×© ×œ×”× ×›×‘×¨ ×—× ×™×š

children = Children.objects.filter(
    tutoring_status__in=['××—×¤×©_×—×•× ×š', '×™×©_×—×•× ×š']  # ×’× ×™×©_×—×•× ×š!
)

tutors = Tutors.objects.filter(
    tutorship_status='××™×Ÿ_×—× ×™×š'  # ×¨×§ ×—×•× ×›×™× ×¤× ×•×™×™×
)
```

---

## âœ… ×¦'×§×œ×™×¡×˜ ×œ×¤×™×ª×•×—

### ×‘×¡×™×¡ × ×ª×•× ×™×:
- [ ] ×œ×•×•×“× ×©××™×Ÿ UNIQUE constraint ×¢×œ child_id ×‘×œ×‘×“ ×‘×˜×‘×œ×ª Tutorships
- [ ] ×œ×•×•×“× ×©-UNIQUE constraint ×”×•× ×¢×œ (child_id, tutor_id)

### Backend:
- [ ] ×¢×“×›×•×Ÿ `fetch_possible_matches()` - ×œ×”×¡×™×¨ ×¡×™× ×•×Ÿ ×™×œ×“×™× ×¢× ×—×•× ×š
- [ ] ×¢×“×›×•×Ÿ `fetch_possible_matches()` - ×œ×”×•×¡×™×£ ×¡×™× ×•×Ÿ ×—×•× ×›×™× ×¢× ×—× ×™×š
- [ ] ×¢×“×›×•×Ÿ `create_tutorship()` - ×œ×‘×“×•×§ ×× ×–×• ×”×—×•× ×›×•×ª ×”×¨××©×•× ×”
- [ ] ×¢×“×›×•×Ÿ `delete_tutorship()` - ×œ×‘×“×•×§ ×× ×™×© ×¢×•×“ ×—×•× ×›×•×™×•×ª
- [ ] ×¢×“×›×•×Ÿ `get_complete_family_details()` - ×œ×”×—×–×™×¨ ×¨×©×™××ª ×—×•× ×›×™×
- [ ] ×¢×“×›×•×Ÿ `update_family()` - ×œ×ª××•×š ×‘×¢×“×›×•×Ÿ ×—×•× ×š ×¡×¤×¦×™×¤×™
- [ ] ×¢×“×›×•×Ÿ `possible_tutorship_matches_report()` - ×œ×”×¦×™×’ ×™×œ×“×™× ×¢× ×—×•× ×š

### Frontend:
- [ ] ×¢×“×›×•×Ÿ Families.js - ×œ×”×¦×™×’ ×¨×©×™××ª ×—×•× ×›×™×
- [ ] ×¢×“×›×•×Ÿ Tutorships.js - ×× ×¦×¨×™×š ×©×™× ×•×™×™×
- [ ] ×¢×“×›×•×Ÿ TutorVolunteerMgmt.js - ×× ×¦×¨×™×š ×©×™× ×•×™×™×

### ×‘×“×™×§×•×ª:
- [ ] ×™×¦×™×¨×ª ×—×•× ×›×•×ª ×¨××©×•× ×” ×œ×™×œ×“
- [ ] ×™×¦×™×¨×ª ×—×•× ×›×•×ª ×©× ×™×™×” ×œ×™×œ×“
- [ ] ××—×™×§×ª ×—×•× ×›×•×ª ×›×©×™×© ×¢×•×“ ×—×•× ×›×™×
- [ ] ××—×™×§×ª ×”×—×•× ×›×•×ª ×”××—×¨×•× ×”
- [ ] ××©×£ ×”×ª×××•×ª - ×™×œ×“ ×¢× ×—×•× ×š ××•×¤×™×¢
- [ ] ××©×£ ×”×ª×××•×ª - ×—×•× ×š ×¢× ×—× ×™×š ×œ× ××•×¤×™×¢
- [ ] ×“×•×— ×”×ª×××•×ª - ×™×œ×“ ×¢× ×—×•× ×š ××•×¤×™×¢
- [ ] ×ª×¦×•×’×ª ××©×¤×—×” - ×¨×©×™××ª ×—×•× ×›×™×

---

## ğŸ”¢ ×”×¢×¨×›×ª ×–××Ÿ

| ××©×™××” | ×–××Ÿ ××©×•×¢×¨ |
|--------|-----------|
| ×©×™× ×•×™×™ Backend | 3-4 ×©×¢×•×ª |
| ×©×™× ×•×™×™ Frontend | 2-3 ×©×¢×•×ª |
| ×‘×“×™×§×•×ª | 2-3 ×©×¢×•×ª |
| **×¡×”"×›** | **7-10 ×©×¢×•×ª** |

---

## âš ï¸ ×¡×™×›×•× ×™× ×•×¤×ª×¨×•× ×•×ª

| ×¡×™×›×•×Ÿ | ×¤×ª×¨×•×Ÿ |
|-------|--------|
| × ×ª×•× ×™× ×§×™×™××™× ×œ× ×¢×§×‘×™×™× | ×œ×”×¨×™×¥ ×¡×§×¨×™×¤×˜ ×‘×“×™×§×” ×œ×¤× ×™ ×•××—×¨×™ |
| ×‘××’×™× ×‘×©×—×–×•×¨ ×¡×˜×˜×•×¡×™× | ×‘×“×™×§×•×ª ×™×¡×•×“×™×•×ª ×©×œ ××—×™×§×ª ×—×•× ×›×•×™×•×ª |
| ×‘×™×¦×•×¢×™× - queries ××¨×•×‘×™× | ×œ×”×©×ª××© ×‘-prefetch_related |

---

*××¡××š ×–×” ××”×•×•×” ××ª ×”××¤×¨×˜ ×”×˜×›× ×™ ×”×¡×•×¤×™ ×œ×¤×™×ª×•×— ×ª××™×›×” ×‘×¨×™×‘×•×™ ×—×•× ×›×™×*
*×ª××¨×™×š ×™×¦×™×¨×”: 25/01/2026*
*×’×¨×¡×”: 1.0*
